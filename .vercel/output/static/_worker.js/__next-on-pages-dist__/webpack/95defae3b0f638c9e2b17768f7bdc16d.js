var O={},Y=(G,J,K)=>(O.__chunk_4325=(z,N,k)=>{"use strict";k.d(N,{Gl:()=>t,WI:()=>c,hE:()=>A,kS:()=>o,vt:()=>i,y_:()=>g,ye:()=>a});var I=k(2813),T=k(3611),_=k(9560),y=k(129);async function m(d){let h=new TextEncoder().encode(d);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",h))).map(w=>w.toString(16).padStart(2,"0")).join("")}async function s(d,h){return await m(h)===d}function e(d){let h=new T.rs(d.DB,{user:"user",session:"session"}),w=(d.APP_URL||"https://foundrcheck.com").includes("foundrcheck.com");return new I.aF(h,{sessionExpiresIn:new I.i9(30,"d"),sessionCookie:{name:"fc_session",attributes:{sameSite:"lax",secure:w,path:"/",domain:w?".foundrcheck.com":void 0}}})}function i(d){if(!d.GOOGLE_CLIENT_ID||!d.GOOGLE_CLIENT_SECRET)throw Error("Google OAuth credentials not configured");let h=`${d.APP_URL||"https://foundrcheck.com"}/api/auth/google/callback`;return new _.ie(d.GOOGLE_CLIENT_ID,d.GOOGLE_CLIENT_SECRET,h)}async function t(d,h){let w=e(d),b=h.headers.get("cookie")??"",f=w.readSessionCookie(b);return f?await w.validateSession(f):{user:null,session:null}}async function a(d,h,w){if(await d.DB.prepare("SELECT id FROM user WHERE email = ?").bind(h).first())throw Error("EMAIL_TAKEN");let b=(0,y.Z)();await d.DB.prepare("INSERT INTO user (id, email) VALUES (?, ?)").bind(b,h).run();let f=await m(w),R=`email:${h}`;await d.DB.prepare("INSERT INTO key (id, user_id, hashed_password) VALUES (?, ?, ?)").bind(R,b,f).run(),await d.DB.prepare("INSERT OR IGNORE INTO user_profiles (id, email) VALUES (?, ?)").bind(b,h).run();let B=e(d),C=await B.createSession(b,{});return{userId:b,cookie:B.createSessionCookie(C.id).serialize()}}async function c(d,h,w){let b=`email:${h}`,f=await d.DB.prepare("SELECT user_id, hashed_password FROM key WHERE id = ?").bind(b).first();if(!f||!await s(f.hashed_password,w))throw Error("INVALID_CREDENTIALS");let R=e(d),B=await R.createSession(f.user_id,{}),C=R.createSessionCookie(B.id).serialize();return{userId:f.user_id,cookie:C}}async function o(d,h){let w=e(d),b=h.headers.get("cookie")??"",f=w.readSessionCookie(b);return f&&await w.invalidateSession(f),w.createBlankSessionCookie().serialize()}async function g(d,h){let w=await d.DB.prepare("SELECT id FROM user WHERE email = ?").bind(h.email).first();if(w)return w.id;let b=(0,y.Z)();return await d.DB.prepare("INSERT INTO user (id, email) VALUES (?, ?)").bind(b,h.email).run(),await d.DB.prepare("INSERT OR IGNORE INTO user_profiles (id, email) VALUES (?, ?)").bind(b,h.email).run(),b}async function A(d,h){let w=e(d),b=await w.createSession(h,{}),f=w.createSessionCookie(b.id).serialize();return{session:b,cookie:f}}},O.__chunk_2813=(z,N,k)=>{k.d(N,{aF:()=>e,i9:()=>I});class I{constructor(t,a){this.value=t,this.unit=a}value;unit;milliseconds(){return this.unit==="ms"?this.value:this.unit==="s"?1e3*this.value:this.unit==="m"?6e4*this.value:this.unit==="h"?36e5*this.value:this.unit==="d"?864e5*this.value:6048e5*this.value}seconds(){return this.milliseconds()/1e3}transform(t){return new I(Math.round(this.milliseconds()*t),"ms")}}function T(i){return Date.now()<i.getTime()}function _(i){return new Date(Date.now()+i.milliseconds())}class y{constructor(t,a,c){this.cookieName=t,this.cookieExpiresIn=c?.expiresIn??null,this.baseCookieAttributes=a}cookieName;cookieExpiresIn;baseCookieAttributes;createCookie(t){return new m(this.cookieName,t,{...this.baseCookieAttributes,maxAge:this.cookieExpiresIn?.seconds()})}createBlankCookie(){return new m(this.cookieName,"",{...this.baseCookieAttributes,maxAge:0})}parse(t){return function(a){let c=new Map;for(let o of a.split("; ")){let g=o.split("="),A=g[0],d=g[1]??"";A&&c.set(decodeURIComponent(A),decodeURIComponent(d))}return c}(t).get(this.cookieName)??null}}class m{constructor(t,a,c){this.name=t,this.value=a,this.attributes=c}name;value;attributes;serialize(){return function(t,a,c){let o=[];return o.push([encodeURIComponent(t),encodeURIComponent(a)]),c?.domain!==void 0&&o.push(["Domain",c.domain]),c?.expires!==void 0&&o.push(["Expires",c.expires.toUTCString()]),c?.httpOnly&&o.push(["HttpOnly"]),c?.maxAge!==void 0&&o.push(["Max-Age",c.maxAge.toString()]),c?.path!==void 0&&o.push(["Path",c.path]),c?.sameSite==="lax"&&o.push(["SameSite","Lax"]),c?.sameSite==="none"&&o.push(["SameSite","None"]),c?.sameSite==="strict"&&o.push(["SameSite","Strict"]),c?.secure&&o.push(["Secure"]),o.map(g=>g.join("=")).join("; ")}(this.name,this.value,this.attributes)}}var s=k(9160);k(6079);class e{adapter;sessionExpiresIn;sessionCookieController;getSessionAttributes;getUserAttributes;sessionCookieName;constructor(t,a){this.adapter=t,this.getUserAttributes=g=>a&&a.getUserAttributes?a.getUserAttributes(g):{},this.getSessionAttributes=g=>a&&a.getSessionAttributes?a.getSessionAttributes(g):{},this.sessionExpiresIn=a?.sessionExpiresIn??new I(30,"d"),this.sessionCookieName=a?.sessionCookie?.name??"auth_session";let c=this.sessionExpiresIn;a?.sessionCookie?.expires===!1&&(c=new I(400,"d"));let o={httpOnly:!0,secure:!0,sameSite:"lax",path:"/",...a?.sessionCookie?.attributes};this.sessionCookieController=new y(this.sessionCookieName,o,{expiresIn:c})}async getUserSessions(t){let a=await this.adapter.getUserSessions(t),c=[];for(let o of a)T(o.expiresAt)&&c.push({id:o.id,expiresAt:o.expiresAt,userId:o.userId,fresh:!1,...this.getSessionAttributes(o.attributes)});return c}async validateSession(t){let[a,c]=await this.adapter.getSessionAndUser(t);if(!a)return{session:null,user:null};if(!c||!T(a.expiresAt))return await this.adapter.deleteSession(a.id),{session:null,user:null};let o=new Date(a.expiresAt.getTime()-this.sessionExpiresIn.milliseconds()/2),g={...this.getSessionAttributes(a.attributes),id:a.id,userId:a.userId,fresh:!1,expiresAt:a.expiresAt};return T(o)||(g.fresh=!0,g.expiresAt=_(this.sessionExpiresIn),await this.adapter.updateSessionExpiration(a.id,g.expiresAt)),{user:{...this.getUserAttributes(c.attributes),id:c.id},session:g}}async createSession(t,a,c){let o=c?.sessionId??function(A){let d=crypto.getRandomValues(new Uint8Array(25));return(0,s.sS)(d)}(0),g=_(this.sessionExpiresIn);return await this.adapter.setSession({id:o,userId:t,expiresAt:g,attributes:a}),{id:o,userId:t,fresh:!0,expiresAt:g,...this.getSessionAttributes(a)}}async invalidateSession(t){await this.adapter.deleteSession(t)}async invalidateUserSessions(t){await this.adapter.deleteUserSessions(t)}async deleteExpiredSessions(){await this.adapter.deleteExpiredSessions()}readSessionCookie(t){return this.sessionCookieController.parse(t)}readBearerToken(t){let[a,c]=t.split(" ");return a!=="Bearer"?null:c??null}createSessionCookie(t){return this.sessionCookieController.createCookie(t)}createBlankSessionCookie(){return this.sessionCookieController.createBlankCookie()}}},O.__chunk_9560=(z,N,k)=>{k.d(N,{ie:()=>F,yD:()=>V,Uj:()=>o,aV:()=>g});var I,T,_,y,m,s=k(9160),e=k(6079);new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);class i{blockSize=64;size=32;blocks=new Uint8Array(64);currentBlockSize=0;H=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);l=0n;w=new Uint32Array(64);update(r){if(this.l+=8n*BigInt(r.byteLength),this.currentBlockSize+r.byteLength<64){this.blocks.set(r,this.currentBlockSize),this.currentBlockSize+=r.byteLength;return}let n=0;if(this.currentBlockSize>0){let u=r.slice(0,64-this.currentBlockSize);this.blocks.set(u,this.currentBlockSize),this.process(),n+=u.byteLength,this.currentBlockSize=0}for(;n+64<=r.byteLength;){let u=r.slice(n,n+64);this.blocks.set(u),this.process(),n+=64}if(r.byteLength-n>0){let u=r.slice(n);this.blocks.set(u),this.currentBlockSize=u.byteLength}}digest(){this.blocks[this.currentBlockSize]=128,this.currentBlockSize+=1,64-this.currentBlockSize<8&&(this.blocks.fill(0,this.currentBlockSize),this.process(),this.currentBlockSize=0),this.blocks.fill(0,this.currentBlockSize),e.jY.putUint64(this.blocks,this.l,this.blockSize-8),this.process();let r=new Uint8Array(32);for(let n=0;n<8;n++)e.jY.putUint32(r,this.H[n],4*n);return r}process(){for(let x=0;x<16;x++)this.w[x]=(this.blocks[4*x]<<24|this.blocks[4*x+1]<<16|this.blocks[4*x+2]<<8|this.blocks[4*x+3])>>>0;for(let x=16;x<64;x++){let L=((0,e.mv)(this.w[x-2],17)^(0,e.mv)(this.w[x-2],19)^this.w[x-2]>>>10)>>>0,U=((0,e.mv)(this.w[x-15],7)^(0,e.mv)(this.w[x-15],18)^this.w[x-15]>>>3)>>>0;this.w[x]=L+this.w[x-7]+U+this.w[x-16]|0}let r=this.H[0],n=this.H[1],u=this.H[2],p=this.H[3],S=this.H[4],E=this.H[5],H=this.H[6],P=this.H[7];for(let x=0;x<64;x++){let L=P+(((0,e.mv)(S,6)^(0,e.mv)(S,11)^(0,e.mv)(S,25))>>>0)+((S&E^~S&H)>>>0)+t[x]+this.w[x]|0,U=(((0,e.mv)(r,2)^(0,e.mv)(r,13)^(0,e.mv)(r,22))>>>0)+((r&n^r&u^n&u)>>>0)|0;P=H,H=E,E=S,S=p+L|0,p=u,u=n,n=r,r=L+U|0}this.H[0]=r+this.H[0]|0,this.H[1]=n+this.H[1]|0,this.H[2]=u+this.H[2]|0,this.H[3]=p+this.H[3]|0,this.H[4]=S+this.H[4]|0,this.H[5]=E+this.H[5]|0,this.H[6]=H+this.H[6]|0,this.H[7]=P+this.H[7]|0}}let t=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),a=new BigUint64Array([0x428a2f98d728ae22n,0x7137449123ef65cdn,0xb5c0fbcfec4d3b2fn,0xe9b5dba58189dbbcn,0x3956c25bf348b538n,0x59f111f1b605d019n,0x923f82a4af194f9bn,0xab1c5ed5da6d8118n,0xd807aa98a3030242n,0x12835b0145706fben,0x243185be4ee4b28cn,0x550c7dc3d5ffb4e2n,0x72be5d74f27b896fn,0x80deb1fe3b1696b1n,0x9bdc06a725c71235n,0xc19bf174cf692694n,0xe49b69c19ef14ad2n,0xefbe4786384f25e3n,0xfc19dc68b8cd5b5n,0x240ca1cc77ac9c65n,0x2de92c6f592b0275n,0x4a7484aa6ea6e483n,0x5cb0a9dcbd41fbd4n,0x76f988da831153b5n,0x983e5152ee66dfabn,0xa831c66d2db43210n,0xb00327c898fb213fn,0xbf597fc7beef0ee4n,0xc6e00bf33da88fc2n,0xd5a79147930aa725n,0x6ca6351e003826fn,0x142929670a0e6e70n,0x27b70a8546d22ffcn,0x2e1b21385c26c926n,0x4d2c6dfc5ac42aedn,0x53380d139d95b3dfn,0x650a73548baf63den,0x766a0abb3c77b2a8n,0x81c2c92e47edaee6n,0x92722c851482353bn,0xa2bfe8a14cf10364n,0xa81a664bbc423001n,0xc24b8b70d0f89791n,0xc76c51a30654be30n,0xd192e819d6ef5218n,0xd69906245565a910n,0xf40e35855771202an,0x106aa07032bbd1b8n,0x19a4c116b8d2d0c8n,0x1e376c085141ab53n,0x2748774cdf8eeb99n,0x34b0bcb5e19b48a8n,0x391c0cb3c5c95a63n,0x4ed8aa4ae3418acbn,0x5b9cca4f7763e373n,0x682e6ff3d6b2b8a3n,0x748f82ee5defb2fcn,0x78a5636f43172f60n,0x84c87814a1f0ab72n,0x8cc702081a6439ecn,0x90befffa23631e28n,0xa4506cebde82bde9n,0xbef9a3f7b2c67915n,0xc67178f2e372532bn,0xca273eceea26619cn,0xd186b8c721c0c207n,0xeada7dd6cde0eb1en,0xf57d4f7fee6ed178n,0x6f067aa72176fban,0xa637dc5a2c898a6n,0x113f9804bef90daen,0x1b710b35131c471bn,0x28db77f523047d84n,0x32caab7b40c72493n,0x3c9ebe0a15c9bebcn,0x431d67c49c100d4cn,0x4cc5d4becb3e42b6n,0x597f299cfc657e2an,0x5fcb6fab3ad6faecn,0x6c44198c4a475817n]);class c{data;constructor(r){this.data=r}tokenType(){if("token_type"in this.data&&typeof this.data.token_type=="string")return this.data.token_type;throw Error("Missing or invalid 'token_type' field")}accessToken(){if("access_token"in this.data&&typeof this.data.access_token=="string")return this.data.access_token;throw Error("Missing or invalid 'access_token' field")}accessTokenExpiresInSeconds(){if("expires_in"in this.data&&typeof this.data.expires_in=="number")return this.data.expires_in;throw Error("Missing or invalid 'expires_in' field")}accessTokenExpiresAt(){return new Date(Date.now()+1e3*this.accessTokenExpiresInSeconds())}hasRefreshToken(){return"refresh_token"in this.data&&typeof this.data.refresh_token=="string"}refreshToken(){if("refresh_token"in this.data&&typeof this.data.refresh_token=="string")return this.data.refresh_token;throw Error("Missing or invalid 'refresh_token' field")}hasScopes(){return"scope"in this.data&&typeof this.data.scope=="string"}scopes(){if("scope"in this.data&&typeof this.data.scope=="string")return this.data.scope.split(" ");throw Error("Missing or invalid 'scope' field")}idToken(){if("id_token"in this.data&&typeof this.data.id_token=="string")return this.data.id_token;throw Error("Missing or invalid field 'id_token'")}}function o(){let l=new Uint8Array(32);return crypto.getRandomValues(l),s.Hs(l)}function g(){let l=new Uint8Array(32);return crypto.getRandomValues(l),s.Hs(l)}function A(l,r){let n=new TextEncoder().encode(r.toString()),u=new Request(l,{method:"POST",body:n});return u.headers.set("Content-Type","application/x-www-form-urlencoded"),u.headers.set("Accept","application/json"),u.headers.set("User-Agent","arctic"),u.headers.set("Content-Length",n.byteLength.toString()),u}function d(l,r){let n=new TextEncoder().encode(`${l}:${r}`);return s.oF(n)}async function h(l){let r;try{r=await fetch(l)}catch(n){throw new f(n)}if(r.status===400||r.status===401){let n,u;try{n=await r.json()}catch{throw new B(r.status)}if(typeof n!="object"||n===null)throw new C(r.status,n);try{u=b(n)}catch{throw new C(r.status,n)}throw u}if(r.status===200){let n;try{n=await r.json()}catch{throw new B(r.status)}if(typeof n!="object"||n===null)throw new C(r.status,n);return new c(n)}throw r.body!==null&&await r.body.cancel(),new B(r.status)}async function w(l){let r;try{r=await fetch(l)}catch(n){throw new f(n)}if(r.status===400||r.status===401){let n,u;try{n=await r.json()}catch{throw new C(r.status,null)}if(typeof n!="object"||n===null)throw new C(r.status,n);try{u=b(n)}catch{throw new C(r.status,n)}throw u}if(r.status===200){r.body!==null&&await r.body.cancel();return}throw r.body!==null&&await r.body.cancel(),new B(r.status)}function b(l){let r;if("error"in l&&typeof l.error=="string")r=l.error;else throw Error("Invalid error response");let n=null,u=null,p=null;if("error_description"in l){if(typeof l.error_description!="string")throw Error("Invalid data");n=l.error_description}if("error_uri"in l){if(typeof l.error_uri!="string")throw Error("Invalid data");u=l.error_uri}if("state"in l){if(typeof l.state!="string")throw Error("Invalid data");p=l.state}return new R(r,n,u,p)}class f extends Error{constructor(r){super("Failed to send request",{cause:r})}}class R extends Error{code;description;uri;state;constructor(r,n,u,p){super(`OAuth request error: ${r}`),this.code=r,this.description=n,this.uri=u,this.state=p}}class B extends Error{status;constructor(r){super("Unexpected error response"),this.status=r}}class C extends Error{status;data;constructor(r,n){super("Unexpected error response body"),this.status=r,this.data=n}}class ${clientId;clientPassword;redirectURI;constructor(r,n,u){this.clientId=r,this.clientPassword=n,this.redirectURI=u}createAuthorizationURL(r,n,u){let p=new URL(r);return p.searchParams.set("response_type","code"),p.searchParams.set("client_id",this.clientId),this.redirectURI!==null&&p.searchParams.set("redirect_uri",this.redirectURI),p.searchParams.set("state",n),u.length>0&&p.searchParams.set("scope",u.join(" ")),p}createAuthorizationURLWithPKCE(r,n,u,p,S){let E=new URL(r);if(E.searchParams.set("response_type","code"),E.searchParams.set("client_id",this.clientId),this.redirectURI!==null&&E.searchParams.set("redirect_uri",this.redirectURI),E.searchParams.set("state",n),u===I.S256){let H=function(P){let x=function(L){let U=new i;return U.update(L),U.digest()}(new TextEncoder().encode(P));return s.Hs(x)}(p);E.searchParams.set("code_challenge_method","S256"),E.searchParams.set("code_challenge",H)}else u===I.Plain&&(E.searchParams.set("code_challenge_method","plain"),E.searchParams.set("code_challenge",p));return S.length>0&&E.searchParams.set("scope",S.join(" ")),E}async validateAuthorizationCode(r,n,u){let p=new URLSearchParams;p.set("grant_type","authorization_code"),p.set("code",n),this.redirectURI!==null&&p.set("redirect_uri",this.redirectURI),u!==null&&p.set("code_verifier",u),this.clientPassword===null&&p.set("client_id",this.clientId);let S=A(r,p);if(this.clientPassword!==null){let E=d(this.clientId,this.clientPassword);S.headers.set("Authorization",`Basic ${E}`)}return await h(S)}async refreshAccessToken(r,n,u){let p=new URLSearchParams;p.set("grant_type","refresh_token"),p.set("refresh_token",n),this.clientPassword===null&&p.set("client_id",this.clientId),u.length>0&&p.set("scope",u.join(" "));let S=A(r,p);if(this.clientPassword!==null){let E=d(this.clientId,this.clientPassword);S.headers.set("Authorization",`Basic ${E}`)}return await h(S)}async revokeToken(r,n){let u=new URLSearchParams;u.set("token",n),this.clientPassword===null&&u.set("client_id",this.clientId);let p=A(r,u);if(this.clientPassword!==null){let S=d(this.clientId,this.clientPassword);p.headers.set("Authorization",`Basic ${S}`)}await w(p)}}(function(l){l[l.S256=0]="S256",l[l.Plain=1]="Plain"})(I||(I={})),function(l){l[l.Include=0]="Include",l[l.None=1]="None"}(T||(T={})),function(l){l[l.Required=0]="Required",l[l.Ignore=1]="Ignore"}(_||(_={})),function(l){l[l.Include=0]="Include",l[l.None=1]="None"}(y||(y={})),function(l){l[l.Required=0]="Required",l[l.Ignore=1]="Ignore"}(m||(m={}));let W={0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,"-":62,_:63},M="https://oauth2.googleapis.com/token";class F{client;constructor(r,n,u){this.client=new $(r,n,u)}createAuthorizationURL(r,n,u){return this.client.createAuthorizationURLWithPKCE("https://accounts.google.com/o/oauth2/v2/auth",r,I.S256,n,u)}async validateAuthorizationCode(r,n){return await this.client.validateAuthorizationCode(M,r,n)}async refreshAccessToken(r){return await this.client.refreshAccessToken(M,r,[])}async revokeToken(r){await this.client.revokeToken("https://oauth2.googleapis.com/revoke",r)}}function V(l){try{return function(r){let n,u,p=r.split(".");if(p.length!==3)throw Error("Invalid JWT");try{var S;n=new TextDecoder().decode((S=p[1],function(E,H,P){let x=new Uint8Array(3*Math.ceil(E.length/4)),L=0;for(let U=0;U<E.length;U+=4){let j=0,D=0;for(let v=0;v<4;v++)if((P!==m.Required||E[U+v]!=="=")&&(P!==m.Ignore||!(U+v>=E.length)&&E[U+v]!=="=")){if(v>0&&E[U+v-1]==="=")throw Error("Invalid padding");if(!(E[U+v]in H))throw Error("Invalid character");j|=H[E[U+v]]<<(3-v)*6,D+=6}if(D<24){let v;if(D===12)v=65535&j;else if(D===18)v=255&j;else throw Error("Invalid padding");if(v!==0)throw Error("Invalid padding")}let q=Math.floor(D/8);for(let v=0;v<q;v++)x[L]=j>>16-8*v&255,L++}return x.slice(0,L)}(S,W,m.Ignore)))}catch{throw Error("Invalid JWT: Invalid base64url encoding")}try{u=JSON.parse(n)}catch{throw Error("Invalid JWT: Invalid JSON encoding")}if(typeof u!="object"||u===null)throw Error("Invalid JWT: Invalid payload");return u}(l)}catch(r){throw Error("Invalid ID token",{cause:r})}}},O.__chunk_9160=(z,N,k)=>{var I,T,_,y;function m(o){return function(g,A,d){let h="";for(let w=0;w<g.byteLength;w+=5){let b=0n,f=0;for(let R=0;R<5&&w+R<g.byteLength;R++)b=b<<8n|BigInt(g[w+R]),f+=8;f%5!=0&&(b<<=BigInt(5-f%5),f+=5-f%5);for(let R=0;R<8;R++)f>=5?(h+=A[Number(b>>BigInt(f-5)&31n)],f-=5):f>0?(h+=A[Number(b<<BigInt(6-f)&63n)],f=0):d===I.Include&&(h+="=")}return h}(o,s,I.None)}k.d(N,{sS:()=>m,oF:()=>e,Hs:()=>i});let s="abcdefghijklmnopqrstuvwxyz234567";function e(o){return t(o,a,_.Include)}function i(o){return t(o,c,_.None)}function t(o,g,A){let d="";for(let h=0;h<o.byteLength;h+=3){let w=0,b=0;for(let f=0;f<3&&h+f<o.byteLength;f++)w=w<<8|o[h+f],b+=8;for(let f=0;f<4;f++)b>=6?(d+=g[w>>b-6&63],b-=6):b>0?(d+=g[w<<6-b&63],b=0):A===_.Include&&(d+="=")}return d}(function(o){o[o.Include=0]="Include",o[o.None=1]="None"})(I||(I={})),function(o){o[o.Required=0]="Required",o[o.Ignore=1]="Ignore"}(T||(T={}));let a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";(function(o){o[o.Include=0]="Include",o[o.None=1]="None"})(_||(_={})),function(o){o[o.Required=0]="Required",o[o.Ignore=1]="Ignore"}(y||(y={}))},O.__chunk_6079=(z,N,k)=>{k.d(N,{jY:()=>_,mv:()=>y});class I{uint8(s,e){if(s.byteLength<e+1)throw TypeError("Insufficient bytes");return s[e]}uint16(s,e){if(s.byteLength<e+2)throw TypeError("Insufficient bytes");return s[e]<<8|s[e+1]}uint32(s,e){if(s.byteLength<e+4)throw TypeError("Insufficient bytes");let i=0;for(let t=0;t<4;t++)i|=s[e+t]<<24-8*t;return i}uint64(s,e){if(s.byteLength<e+8)throw TypeError("Insufficient bytes");let i=0n;for(let t=0;t<8;t++)i|=BigInt(s[e+t])<<BigInt(56-8*t);return i}putUint8(s,e,i){if(s.length<i+1)throw TypeError("Not enough space");if(e<0||e>255)throw TypeError("Invalid uint8 value");s[i]=e}putUint16(s,e,i){if(s.length<i+2)throw TypeError("Not enough space");if(e<0||e>65535)throw TypeError("Invalid uint16 value");s[i]=e>>8,s[i+1]=255&e}putUint32(s,e,i){if(s.length<i+4)throw TypeError("Not enough space");if(e<0||e>4294967295)throw TypeError("Invalid uint32 value");for(let t=0;t<4;t++)s[i+t]=e>>(3-t)*8&255}putUint64(s,e,i){if(s.length<i+8)throw TypeError("Not enough space");if(e<0||e>0xffffffffffffffffn)throw TypeError("Invalid uint64 value");for(let t=0;t<8;t++)s[i+t]=Number(e>>BigInt((7-t)*8)&255n)}}class T{uint8(s,e){if(s.byteLength<e+1)throw TypeError("Insufficient bytes");return s[e]}uint16(s,e){if(s.byteLength<e+2)throw TypeError("Insufficient bytes");return s[e]|s[e+1]<<8}uint32(s,e){if(s.byteLength<e+4)throw TypeError("Insufficient bytes");let i=0;for(let t=0;t<4;t++)i|=s[e+t]<<8*t;return i}uint64(s,e){if(s.byteLength<e+8)throw TypeError("Insufficient bytes");let i=0n;for(let t=0;t<8;t++)i|=BigInt(s[e+t])<<BigInt(8*t);return i}putUint8(s,e,i){if(s.length<1+i)throw TypeError("Insufficient space");if(e<0||e>255)throw TypeError("Invalid uint8 value");s[i]=e}putUint16(s,e,i){if(s.length<2+i)throw TypeError("Insufficient space");if(e<0||e>65535)throw TypeError("Invalid uint16 value");s[i+1]=e>>8,s[i]=255&e}putUint32(s,e,i){if(s.length<4+i)throw TypeError("Insufficient space");if(e<0||e>4294967295)throw TypeError("Invalid uint32 value");for(let t=0;t<4;t++)s[i+t]=e>>8*t&255}putUint64(s,e,i){if(s.length<8+i)throw TypeError("Insufficient space");if(e<0||e>0xffffffffffffffffn)throw TypeError("Invalid uint64 value");for(let t=0;t<8;t++)s[i+t]=Number(e>>BigInt(8*t)&255n)}}let _=new I;function y(m,s){return(m<<32-s|m>>>s)>>>0}new T},O.__chunk_3611=(z,N,k)=>{k.d(N,{rs:()=>y});class I{controller;escapedUserTableName;escapedSessionTableName;constructor(e,i){this.controller=e,this.escapedSessionTableName=_(i.session),this.escapedUserTableName=_(i.user)}async deleteSession(e){await this.controller.execute(`DELETE FROM ${this.escapedSessionTableName} WHERE id = ?`,[e])}async deleteUserSessions(e){await this.controller.execute(`DELETE FROM ${this.escapedSessionTableName} WHERE user_id = ?`,[e])}async getSessionAndUser(e){let[i,t]=await Promise.all([this.getSession(e),this.getUserFromSessionId(e)]);return[i,t]}async getUserSessions(e){return(await this.controller.getAll(`SELECT * FROM ${this.escapedSessionTableName} WHERE user_id = ?`,[e])).map(i=>T(i))}async setSession(e){let i=Object.entries({id:e.id,user_id:e.userId,expires_at:Math.floor(e.expiresAt.getTime()/1e3),...e.attributes}).filter(([o,g])=>g!==void 0),t=i.map(([o])=>_(o)),a=Array(t.length).fill("?"),c=i.map(([o,g])=>g);await this.controller.execute(`INSERT INTO ${this.escapedSessionTableName} (${t.join(", ")}) VALUES (${a.join(", ")})`,c)}async updateSessionExpiration(e,i){await this.controller.execute(`UPDATE ${this.escapedSessionTableName} SET expires_at = ? WHERE id = ?`,[Math.floor(i.getTime()/1e3),e])}async deleteExpiredSessions(){await this.controller.execute(`DELETE FROM ${this.escapedSessionTableName} WHERE expires_at <= ?`,[Math.floor(Date.now()/1e3)])}async getSession(e){let i=await this.controller.get(`SELECT * FROM ${this.escapedSessionTableName} WHERE id = ?`,[e]);return i?T(i):null}async getUserFromSessionId(e){let i=await this.controller.get(`SELECT ${this.escapedUserTableName}.* FROM ${this.escapedSessionTableName} INNER JOIN ${this.escapedUserTableName} ON ${this.escapedUserTableName}.id = ${this.escapedSessionTableName}.user_id WHERE ${this.escapedSessionTableName}.id = ?`,[e]);return i?function(t){let{id:a,...c}=t;return{id:a,attributes:c}}(i):null}}function T(s){let{id:e,user_id:i,expires_at:t,...a}=s;return{userId:i,id:e,expiresAt:new Date(1e3*t),attributes:a}}function _(s){return"`"+s+"`"}class y extends I{constructor(e,i){super(new m(e),i)}}class m{db;constructor(e){this.db=e}async get(e,i){return await this.db.prepare(e).bind(...i).first()}async getAll(e,i){return(await this.db.prepare(e).bind(...i).all()).results??[]}async execute(e,i){await this.db.prepare(e).bind(...i).run()}}},O.__chunk_129=(z,N,k)=>{let I;k.d(N,{Z:()=>m});let T={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},_=new Uint8Array(16),y=[];for(let s=0;s<256;++s)y.push((s+256).toString(16).slice(1));let m=function(s,e,i){if(T.randomUUID&&!e&&!s)return T.randomUUID();let t=(s=s||{}).random||(s.rng||function(){if(!I&&!(I=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return I(_)})();if(t[6]=15&t[6]|64,t[8]=63&t[8]|128,e){i=i||0;for(let a=0;a<16;++a)e[i+a]=t[a];return e}return function(a,c=0){return y[a[c+0]]+y[a[c+1]]+y[a[c+2]]+y[a[c+3]]+"-"+y[a[c+4]]+y[a[c+5]]+"-"+y[a[c+6]]+y[a[c+7]]+"-"+y[a[c+8]]+y[a[c+9]]+"-"+y[a[c+10]]+y[a[c+11]]+y[a[c+12]]+y[a[c+13]]+y[a[c+14]]+y[a[c+15]]}(t)}},O);export{Y as __getNamedExports};
