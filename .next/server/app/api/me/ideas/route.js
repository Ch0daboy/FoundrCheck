(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[729],{2067:e=>{"use strict";e.exports=require("node:async_hooks")},6195:e=>{"use strict";e.exports=require("node:buffer")},9856:(e,i,r)=>{"use strict";r.r(i),r.d(i,{ComponentMod:()=>m,default:()=>R});var a={};r.r(a),r.d(a,{GET:()=>E,runtime:()=>l});var t={};r.r(t),r.d(t,{originalPathname:()=>_,patchFetch:()=>h,requestAsyncStorage:()=>f,routeModule:()=>p,serverHooks:()=>w,staticGenerationAsyncStorage:()=>S});var n=r(6637),s=r(1554),o=r(2130),u=r(7425),d=r(4325),c=r(4381);let l="edge";async function E(e){let i=(0,c.O)(),{user:r}=await (0,d.Gl)(i,e);return r?new Response(JSON.stringify((await i.DB.prepare("SELECT * FROM ideas WHERE owner_id = ? ORDER BY created_at DESC").bind(r.id).all()).results??[]),{status:200}):new Response("Unauthorized",{status:401})}let p=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/me/ideas/route",pathname:"/api/me/ideas",filename:"route",bundlePath:"app/api/me/ideas/route"},resolvedPagePath:"/home/noob/FoundrCheck/app/api/me/ideas/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:S,serverHooks:w}=p,_="/api/me/ideas/route";function h(){return(0,u.XH)({serverHooks:w,staticGenerationAsyncStorage:S})}let m=t,R=n.a.wrap(p)},4381:(e,i,r)=>{"use strict";r.d(i,{O:()=>t});var a=r(6493);function t(){return(0,a.getRequestContext)().env}},4325:(e,i,r)=>{"use strict";r.d(i,{Gl:()=>l,WI:()=>p,hE:()=>w,kS:()=>f,vt:()=>c,y_:()=>S,ye:()=>E});var a=r(2813),t=r(3611),n=r(9560),s=r(129);async function o(e){let i=new TextEncoder().encode(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",i))).map(e=>e.toString(16).padStart(2,"0")).join("")}async function u(e,i){return await o(i)===e}function d(e){let i=new t.rs(e.DB,{user:"user",session:"session"}),r=(e.APP_URL||"https://foundrcheck.com").includes("foundrcheck.com");return new a.aF(i,{sessionExpiresIn:new a.i9(30,"d"),sessionCookie:{name:"fc_session",attributes:{sameSite:"lax",secure:r,path:"/",domain:r?".foundrcheck.com":void 0}}})}function c(e){if(!e.GOOGLE_CLIENT_ID||!e.GOOGLE_CLIENT_SECRET)throw Error("Google OAuth credentials not configured");let i=`${e.APP_URL||"https://foundrcheck.com"}/api/auth/google/callback`;return new n.ie(e.GOOGLE_CLIENT_ID,e.GOOGLE_CLIENT_SECRET,i)}async function l(e,i){let r=d(e),a=i.headers.get("cookie")??"",t=r.readSessionCookie(a);return t?await r.validateSession(t):{user:null,session:null}}async function E(e,i,r){if(await e.DB.prepare("SELECT id FROM user WHERE email = ?").bind(i).first())throw Error("EMAIL_TAKEN");let a=(0,s.Z)();await e.DB.prepare("INSERT INTO user (id, email) VALUES (?, ?)").bind(a,i).run();let t=await o(r),n=`email:${i}`;await e.DB.prepare("INSERT INTO key (id, user_id, hashed_password) VALUES (?, ?, ?)").bind(n,a,t).run(),await e.DB.prepare("INSERT OR IGNORE INTO user_profiles (id, email) VALUES (?, ?)").bind(a,i).run();let u=d(e),c=await u.createSession(a,{});return{userId:a,cookie:u.createSessionCookie(c.id).serialize()}}async function p(e,i,r){let a=`email:${i}`,t=await e.DB.prepare("SELECT user_id, hashed_password FROM key WHERE id = ?").bind(a).first();if(!t||!await u(t.hashed_password,r))throw Error("INVALID_CREDENTIALS");let n=d(e),s=await n.createSession(t.user_id,{}),o=n.createSessionCookie(s.id).serialize();return{userId:t.user_id,cookie:o}}async function f(e,i){let r=d(e),a=i.headers.get("cookie")??"",t=r.readSessionCookie(a);return t&&await r.invalidateSession(t),r.createBlankSessionCookie().serialize()}async function S(e,i){let r=await e.DB.prepare("SELECT id FROM user WHERE email = ?").bind(i.email).first();if(r)return r.id;let a=(0,s.Z)();return await e.DB.prepare("INSERT INTO user (id, email) VALUES (?, ?)").bind(a,i.email).run(),await e.DB.prepare("INSERT OR IGNORE INTO user_profiles (id, email) VALUES (?, ?)").bind(a,i.email).run(),a}async function w(e,i){let r=d(e),a=await r.createSession(i,{}),t=r.createSessionCookie(a.id).serialize();return{session:a,cookie:t}}}},e=>{var i=i=>e(e.s=i);e.O(0,[776,481,745],()=>i(9856));var r=e.O();(_ENTRIES="undefined"==typeof _ENTRIES?{}:_ENTRIES)["middleware_app/api/me/ideas/route"]=r}]);
//# sourceMappingURL=route.js.map