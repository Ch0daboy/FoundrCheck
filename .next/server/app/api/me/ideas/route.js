(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[729],{2067:e=>{"use strict";e.exports=require("node:async_hooks")},6195:e=>{"use strict";e.exports=require("node:buffer")},9856:(e,a,r)=>{"use strict";r.r(a),r.d(a,{ComponentMod:()=>_,default:()=>m});var i={};r.r(i),r.d(i,{GET:()=>c,runtime:()=>l});var t={};r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>R,requestAsyncStorage:()=>w,routeModule:()=>E,serverHooks:()=>f,staticGenerationAsyncStorage:()=>S});var s=r(6637),n=r(1554),o=r(2130),u=r(7425),d=r(4325),p=r(4381);let l="edge";async function c(e){let a=(0,p.O)(),{user:r}=await (0,d.Gl)(a,e);return r?new Response(JSON.stringify((await a.DB.prepare("SELECT * FROM ideas WHERE owner_id = ? ORDER BY created_at DESC").bind(r.id).all()).results??[]),{status:200}):new Response("Unauthorized",{status:401})}let E=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/me/ideas/route",pathname:"/api/me/ideas",filename:"route",bundlePath:"app/api/me/ideas/route"},resolvedPagePath:"/home/noob/FoundrCheck/app/api/me/ideas/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:w,staticGenerationAsyncStorage:S,serverHooks:f}=E,h="/api/me/ideas/route";function R(){return(0,u.XH)({serverHooks:f,staticGenerationAsyncStorage:S})}let _=t,m=s.a.wrap(E)},4381:(e,a,r)=>{"use strict";r.d(a,{O:()=>t});var i=r(6493);function t(){return(0,i.getRequestContext)().env}},4325:(e,a,r)=>{"use strict";r.d(a,{Gl:()=>d,WI:()=>l,kS:()=>c,ye:()=>p});var i=r(7766),t=r(3611),s=r(129);async function n(e){let a=new TextEncoder().encode(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",a))).map(e=>e.toString(16).padStart(2,"0")).join("")}async function o(e,a){return await n(a)===e}function u(e){let a=new t.rs(e.DB,{user:"user",session:"session"});return new i.aF(a,{sessionExpiresIn:new i.i9(30,"d"),sessionCookie:{name:"fc_session",attributes:{sameSite:"lax",secure:!0,path:"/"}}})}async function d(e,a){let r=u(e),i=a.headers.get("cookie")??"",t=r.readSessionCookie(i);return t?await r.validateSession(t):{user:null,session:null}}async function p(e,a,r){if(await e.DB.prepare("SELECT id FROM user WHERE email = ?").bind(a).first())throw Error("EMAIL_TAKEN");let i=(0,s.Z)();await e.DB.prepare("INSERT INTO user (id, email) VALUES (?, ?)").bind(i,a).run();let t=await n(r),o=`email:${a}`;await e.DB.prepare("INSERT INTO key (id, user_id, hashed_password) VALUES (?, ?, ?)").bind(o,i,t).run(),await e.DB.prepare("INSERT OR IGNORE INTO user_profiles (id, email) VALUES (?, ?)").bind(i,a).run();let d=u(e),p=await d.createSession(i,{});return{userId:i,cookie:d.createSessionCookie(p.id).serialize()}}async function l(e,a,r){let i=`email:${a}`,t=await e.DB.prepare("SELECT user_id, hashed_password FROM key WHERE id = ?").bind(i).first();if(!t||!await o(t.hashed_password,r))throw Error("INVALID_CREDENTIALS");let s=u(e),n=await s.createSession(t.user_id,{}),d=s.createSessionCookie(n.id).serialize();return{userId:t.user_id,cookie:d}}async function c(e,a){let r=u(e),i=a.headers.get("cookie")??"",t=r.readSessionCookie(i);return t&&await r.invalidateSession(t),r.createBlankSessionCookie().serialize()}}},e=>{var a=a=>e(e.s=a);e.O(0,[776,481,875],()=>a(9856));var r=e.O();(_ENTRIES="undefined"==typeof _ENTRIES?{}:_ENTRIES)["middleware_app/api/me/ideas/route"]=r}]);
//# sourceMappingURL=route.js.map