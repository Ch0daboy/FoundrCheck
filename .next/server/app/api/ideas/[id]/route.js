(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[873],{2067:e=>{"use strict";e.exports=require("node:async_hooks")},6195:e=>{"use strict";e.exports=require("node:buffer")},9542:(e,i,a)=>{"use strict";a.r(i),a.d(i,{ComponentMod:()=>m,default:()=>R});var r={};a.r(r),a.d(r,{GET:()=>p,runtime:()=>c});var t={};a.r(t),a.d(t,{originalPathname:()=>S,patchFetch:()=>h,requestAsyncStorage:()=>_,routeModule:()=>E,serverHooks:()=>f,staticGenerationAsyncStorage:()=>w});var s=a(6637),n=a(1554),o=a(2130),d=a(7425),u=a(4325),l=a(4381);let c="edge";async function p(e,i){let a=(0,l.O)(),r=i.params.id,{user:t}=await (0,u.Gl)(a,e),s=t?.id??null,n=await a.DB.prepare("SELECT * FROM ideas WHERE id = ?").bind(r).all();return n.results?.length?new Response(JSON.stringify(function(e,i){let a=i&&e.owner_id===i;return{id:e.id,owner_id:a?e.owner_id:void 0,title:e.title,description:e.description,idea_hash:a?e.idea_hash:void 0,visibility:e.visibility,status:e.status,score:e.score,analysis_summary:e.analysis_summary,analysis_raw:a?e.analysis_raw:void 0,created_at:e.created_at,updated_at:e.updated_at,owner_anon:!a}}(n.results[0],s)),{status:200}):new Response("Not found",{status:404})}let E=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/ideas/[id]/route",pathname:"/api/ideas/[id]",filename:"route",bundlePath:"app/api/ideas/[id]/route"},resolvedPagePath:"/home/noob/FoundrCheck/app/api/ideas/[id]/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:_,staticGenerationAsyncStorage:w,serverHooks:f}=E,S="/api/ideas/[id]/route";function h(){return(0,d.XH)({serverHooks:f,staticGenerationAsyncStorage:w})}let m=t,R=s.a.wrap(E)},4381:(e,i,a)=>{"use strict";a.d(i,{O:()=>t});var r=a(6493);function t(){return(0,r.getRequestContext)().env}},4325:(e,i,a)=>{"use strict";a.d(i,{Gl:()=>c,WI:()=>E,hE:()=>f,kS:()=>_,vt:()=>l,y_:()=>w,ye:()=>p});var r=a(2813),t=a(3611),s=a(9560),n=a(129);async function o(e){let i=new TextEncoder().encode(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",i))).map(e=>e.toString(16).padStart(2,"0")).join("")}async function d(e,i){return await o(i)===e}function u(e){let i=new t.rs(e.DB,{user:"user",session:"session"}),a=(e.APP_URL||"https://foundrcheck.com").includes("foundrcheck.com");return new r.aF(i,{sessionExpiresIn:new r.i9(30,"d"),sessionCookie:{name:"fc_session",attributes:{sameSite:"lax",secure:a,path:"/",domain:a?".foundrcheck.com":void 0}}})}function l(e){if(!e.GOOGLE_CLIENT_ID||!e.GOOGLE_CLIENT_SECRET)throw Error("Google OAuth credentials not configured");let i=`${e.APP_URL||"https://foundrcheck.com"}/api/auth/google/callback`;return new s.ie(e.GOOGLE_CLIENT_ID,e.GOOGLE_CLIENT_SECRET,i)}async function c(e,i){let a=u(e),r=i.headers.get("cookie")??"",t=a.readSessionCookie(r);return t?await a.validateSession(t):{user:null,session:null}}async function p(e,i,a){if(await e.DB.prepare("SELECT id FROM user WHERE email = ?").bind(i).first())throw Error("EMAIL_TAKEN");let r=(0,n.Z)();await e.DB.prepare("INSERT INTO user (id, email) VALUES (?, ?)").bind(r,i).run();let t=await o(a),s=`email:${i}`;await e.DB.prepare("INSERT INTO key (id, user_id, hashed_password) VALUES (?, ?, ?)").bind(s,r,t).run(),await e.DB.prepare("INSERT OR IGNORE INTO user_profiles (id, email) VALUES (?, ?)").bind(r,i).run();let d=u(e),l=await d.createSession(r,{});return{userId:r,cookie:d.createSessionCookie(l.id).serialize()}}async function E(e,i,a){let r=`email:${i}`,t=await e.DB.prepare("SELECT user_id, hashed_password FROM key WHERE id = ?").bind(r).first();if(!t||!await d(t.hashed_password,a))throw Error("INVALID_CREDENTIALS");let s=u(e),n=await s.createSession(t.user_id,{}),o=s.createSessionCookie(n.id).serialize();return{userId:t.user_id,cookie:o}}async function _(e,i){let a=u(e),r=i.headers.get("cookie")??"",t=a.readSessionCookie(r);return t&&await a.invalidateSession(t),a.createBlankSessionCookie().serialize()}async function w(e,i){let a=await e.DB.prepare("SELECT id FROM user WHERE email = ?").bind(i.email).first();if(a)return a.id;let r=(0,n.Z)();return await e.DB.prepare("INSERT INTO user (id, email) VALUES (?, ?)").bind(r,i.email).run(),await e.DB.prepare("INSERT OR IGNORE INTO user_profiles (id, email) VALUES (?, ?)").bind(r,i.email).run(),r}async function f(e,i){let a=u(e),r=await a.createSession(i,{}),t=a.createSessionCookie(r.id).serialize();return{session:r,cookie:t}}}},e=>{var i=i=>e(e.s=i);e.O(0,[776,481,745],()=>i(9542));var a=e.O();(_ENTRIES="undefined"==typeof _ENTRIES?{}:_ENTRIES)["middleware_app/api/ideas/[id]/route"]=a}]);
//# sourceMappingURL=route.js.map