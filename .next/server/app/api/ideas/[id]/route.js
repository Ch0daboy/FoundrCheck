(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[873],{2067:e=>{"use strict";e.exports=require("node:async_hooks")},6195:e=>{"use strict";e.exports=require("node:buffer")},9542:(e,i,a)=>{"use strict";a.r(i),a.d(i,{ComponentMod:()=>y,default:()=>k});var t={};a.r(t),a.d(t,{GET:()=>c,runtime:()=>p});var s={};a.r(s),a.d(s,{originalPathname:()=>S,patchFetch:()=>h,requestAsyncStorage:()=>E,routeModule:()=>w,serverHooks:()=>f,staticGenerationAsyncStorage:()=>_});var r=a(6637),n=a(1554),o=a(2130),d=a(7425),u=a(4325),l=a(4381);let p="edge";async function c(e,i){let a=(0,l.O)(),t=i.params.id,{user:s}=await (0,u.Gl)(a,e),r=s?.id??null,n=await a.DB.prepare("SELECT * FROM ideas WHERE id = ?").bind(t).all();return n.results?.length?new Response(JSON.stringify(function(e,i){let a=i&&e.owner_id===i;return{id:e.id,owner_id:a?e.owner_id:void 0,title:e.title,description:e.description,idea_hash:a?e.idea_hash:void 0,visibility:e.visibility,status:e.status,score:e.score,analysis_summary:e.analysis_summary,analysis_raw:a?e.analysis_raw:void 0,created_at:e.created_at,updated_at:e.updated_at,owner_anon:!a}}(n.results[0],r)),{status:200}):new Response("Not found",{status:404})}let w=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/ideas/[id]/route",pathname:"/api/ideas/[id]",filename:"route",bundlePath:"app/api/ideas/[id]/route"},resolvedPagePath:"/home/noob/FoundrCheck/app/api/ideas/[id]/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:E,staticGenerationAsyncStorage:_,serverHooks:f}=w,S="/api/ideas/[id]/route";function h(){return(0,d.XH)({serverHooks:f,staticGenerationAsyncStorage:_})}let y=s,k=r.a.wrap(w)},4381:(e,i,a)=>{"use strict";a.d(i,{O:()=>s});var t=a(6493);function s(){return(0,t.getRequestContext)().env}},4325:(e,i,a)=>{"use strict";a.d(i,{Gl:()=>u,WI:()=>p,kS:()=>c,ye:()=>l});var t=a(7766),s=a(3611),r=a(129);async function n(e){let i=new TextEncoder().encode(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",i))).map(e=>e.toString(16).padStart(2,"0")).join("")}async function o(e,i){return await n(i)===e}function d(e){let i=new s.rs(e.DB,{user:"user",session:"session"});return new t.aF(i,{sessionExpiresIn:new t.i9(30,"d"),sessionCookie:{name:"fc_session",attributes:{sameSite:"lax",secure:!0,path:"/"}}})}async function u(e,i){let a=d(e),t=i.headers.get("cookie")??"",s=a.readSessionCookie(t);return s?await a.validateSession(s):{user:null,session:null}}async function l(e,i,a){if(await e.DB.prepare("SELECT id FROM user WHERE email = ?").bind(i).first())throw Error("EMAIL_TAKEN");let t=(0,r.Z)();await e.DB.prepare("INSERT INTO user (id, email) VALUES (?, ?)").bind(t,i).run();let s=await n(a),o=`email:${i}`;await e.DB.prepare("INSERT INTO key (id, user_id, hashed_password) VALUES (?, ?, ?)").bind(o,t,s).run(),await e.DB.prepare("INSERT OR IGNORE INTO user_profiles (id, email) VALUES (?, ?)").bind(t,i).run();let u=d(e),l=await u.createSession(t,{});return{userId:t,cookie:u.createSessionCookie(l.id).serialize()}}async function p(e,i,a){let t=`email:${i}`,s=await e.DB.prepare("SELECT user_id, hashed_password FROM key WHERE id = ?").bind(t).first();if(!s||!await o(s.hashed_password,a))throw Error("INVALID_CREDENTIALS");let r=d(e),n=await r.createSession(s.user_id,{}),u=r.createSessionCookie(n.id).serialize();return{userId:s.user_id,cookie:u}}async function c(e,i){let a=d(e),t=i.headers.get("cookie")??"",s=a.readSessionCookie(t);return s&&await a.invalidateSession(s),a.createBlankSessionCookie().serialize()}}},e=>{var i=i=>e(e.s=i);e.O(0,[776,481,875],()=>i(9542));var a=e.O();(_ENTRIES="undefined"==typeof _ENTRIES?{}:_ENTRIES)["middleware_app/api/ideas/[id]/route"]=a}]);
//# sourceMappingURL=route.js.map