(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[884],{2067:e=>{"use strict";e.exports=require("node:async_hooks")},6195:e=>{"use strict";e.exports=require("node:buffer")},4111:(e,t,a)=>{"use strict";a.r(t),a.d(t,{ComponentMod:()=>R,default:()=>y});var r={};a.r(r),a.d(r,{POST:()=>c,runtime:()=>p});var s={};a.r(s),a.d(s,{originalPathname:()=>E,patchFetch:()=>k,requestAsyncStorage:()=>S,routeModule:()=>w,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f});var i=a(6637),n=a(1554),o=a(2130),u=a(7425),d=a(4381),l=a(4325);let p="edge";async function c(e){let t=(0,d.O)(),a=new URL(e.url).pathname.split("/").pop();if("register"===a){let a=await e.json(),r=a?.email,s=a?.password;if(!r||!s)return new Response("Bad request",{status:400});let{userId:i,cookie:n}=await (0,l.ye)(t,r,s);return new Response(JSON.stringify({userId:i}),{status:201,headers:{"Set-Cookie":n}})}if("login"===a){let a=await e.json(),r=a?.email,s=a?.password;if(!r||!s)return new Response("Bad request",{status:400});try{let{cookie:e}=await (0,l.WI)(t,r,s);return new Response(JSON.stringify({ok:!0}),{headers:{"Set-Cookie":e}})}catch{return new Response("Invalid credentials",{status:401})}}return"logout"===a?new Response("",{headers:{"Set-Cookie":await (0,l.kS)(t,e)}}):new Response("Not found",{status:404})}let w=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/[...lucia]/route",pathname:"/api/auth/[...lucia]",filename:"route",bundlePath:"app/api/auth/[...lucia]/route"},resolvedPagePath:"/home/noob/FoundrCheck/app/api/auth/[...lucia]/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:S,staticGenerationAsyncStorage:f,serverHooks:h}=w,E="/api/auth/[...lucia]/route";function k(){return(0,u.XH)({serverHooks:h,staticGenerationAsyncStorage:f})}let R=s,y=i.a.wrap(w)},4381:(e,t,a)=>{"use strict";a.d(t,{O:()=>s});var r=a(6493);function s(){return(0,r.getRequestContext)().env}},4325:(e,t,a)=>{"use strict";a.d(t,{Gl:()=>d,WI:()=>p,kS:()=>c,ye:()=>l});var r=a(7766),s=a(3611),i=a(129);async function n(e){let t=new TextEncoder().encode(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}async function o(e,t){return await n(t)===e}function u(e){let t=new s.rs(e.DB,{user:"user",session:"session"});return new r.aF(t,{sessionExpiresIn:new r.i9(30,"d"),sessionCookie:{name:"fc_session",attributes:{sameSite:"lax",secure:!0,path:"/"}}})}async function d(e,t){let a=u(e),r=t.headers.get("cookie")??"",s=a.readSessionCookie(r);return s?await a.validateSession(s):{user:null,session:null}}async function l(e,t,a){if(await e.DB.prepare("SELECT id FROM user WHERE email = ?").bind(t).first())throw Error("EMAIL_TAKEN");let r=(0,i.Z)();await e.DB.prepare("INSERT INTO user (id, email) VALUES (?, ?)").bind(r,t).run();let s=await n(a),o=`email:${t}`;await e.DB.prepare("INSERT INTO key (id, user_id, hashed_password) VALUES (?, ?, ?)").bind(o,r,s).run(),await e.DB.prepare("INSERT OR IGNORE INTO user_profiles (id, email) VALUES (?, ?)").bind(r,t).run();let d=u(e),l=await d.createSession(r,{});return{userId:r,cookie:d.createSessionCookie(l.id).serialize()}}async function p(e,t,a){let r=`email:${t}`,s=await e.DB.prepare("SELECT user_id, hashed_password FROM key WHERE id = ?").bind(r).first();if(!s||!await o(s.hashed_password,a))throw Error("INVALID_CREDENTIALS");let i=u(e),n=await i.createSession(s.user_id,{}),d=i.createSessionCookie(n.id).serialize();return{userId:s.user_id,cookie:d}}async function c(e,t){let a=u(e),r=t.headers.get("cookie")??"",s=a.readSessionCookie(r);return s&&await a.invalidateSession(s),a.createBlankSessionCookie().serialize()}}},e=>{var t=t=>e(e.s=t);e.O(0,[776,481,875],()=>t(4111));var a=e.O();(_ENTRIES="undefined"==typeof _ENTRIES?{}:_ENTRIES)["middleware_app/api/auth/[...lucia]/route"]=a}]);
//# sourceMappingURL=route.js.map