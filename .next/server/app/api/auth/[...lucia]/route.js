(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[884],{2067:e=>{"use strict";e.exports=require("node:async_hooks")},6195:e=>{"use strict";e.exports=require("node:buffer")},1685:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ComponentMod:()=>k,default:()=>_});var s={};r.r(s),r.d(s,{POST:()=>f,runtime:()=>p});var a={};r.r(a),r.d(a,{originalPathname:()=>m,patchFetch:()=>S,requestAsyncStorage:()=>h,routeModule:()=>w,serverHooks:()=>R,staticGenerationAsyncStorage:()=>E});var i=r(9010),n=r(8126),o=r(3097),u=r(4307),l=r(2491),d=r(830);let p="edge";async function c(e){let t=new TextEncoder().encode(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}async function f(e){let t=(0,l.O)(),r=new URL(e.url).pathname.split("/").pop(),s=(0,d.v0)(t);if("register"===r){let r=await e.json(),a=r?.email,i=r?.password;if(!a||!i)return new Response("Bad request",{status:400});let n=await c(i),o=await (0,d.r4)(t,a,n),u=await s.createSession(o,{}),l=s.createSessionCookie(u.id);return new Response(JSON.stringify({userId:o}),{status:201,headers:{"Set-Cookie":l.serialize()}})}if("login"===r){let r=await e.json(),a=r?.email,i=r?.password;if(!a||!i)return new Response("Bad request",{status:400});let n=await c(i),o=await (0,d.M9)(t,a,n);if(!o)return new Response("Invalid credentials",{status:401});let u=await s.createSession(o,{}),l=s.createSessionCookie(u.id);return new Response(JSON.stringify({ok:!0}),{headers:{"Set-Cookie":l.serialize()}})}if("logout"===r){let t=(0,l.O)();await (0,d.bN)(t,e);let r=(e.headers.get("cookie")||"").match(/fc_session=([^;]+)/),a=r?decodeURIComponent(r[1]):null;return a&&await t.DB.prepare("DELETE FROM sessions WHERE id = ?").bind(a).run(),new Response("",{headers:{"Set-Cookie":s.createBlankSessionCookie().serialize()}})}return new Response("Not found",{status:404})}let w=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/[...lucia]/route",pathname:"/api/auth/[...lucia]",filename:"route",bundlePath:"app/api/auth/[...lucia]/route"},resolvedPagePath:"/home/noob/FoundrCheck/app/api/auth/[...lucia]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:E,serverHooks:R}=w,m="/api/auth/[...lucia]/route";function S(){return(0,u.XH)({serverHooks:R,staticGenerationAsyncStorage:E})}let k=a,_=i.a.wrap(w)},830:(e,t,r)=>{"use strict";r.d(t,{M9:()=>u,bN:()=>d,r4:()=>o,v0:()=>n});var s=r(3804),a=r(6645),i=r(7900);function n(e){let t=new a.rs(e.DB,{user:"users",session:"sessions",key:"user_keys"});return new s.aF(t,{sessionCookie:{name:l,attributes:{secure:!0,httpOnly:!0,sameSite:"lax",path:"/"}},getUserAttributes:e=>({email:e.email})})}async function o(e,t,r){let s=(0,i.Z)(),a=n(e);return await a.createUser({userId:s,key:{providerId:"email",providerUserId:t,password:r},attributes:{email:t}}),await e.DB.prepare("INSERT OR IGNORE INTO user_profiles (id, email) VALUES (?, ?)").bind(s,t).run(),s}async function u(e,t,r){let s=`email:${t}`,a=await e.DB.prepare("SELECT user_id, hashed_password FROM user_keys WHERE id = ?").bind(s).all(),i=a.results?.[0];return i&&i.hashed_password===r?i.user_id:null}let l="fc_session";async function d(e,t){let r=function(e,t){let r=e.headers.get("cookie");if(!r)return null;for(let e of r.split(";")){let[r,s]=e.trim().split("=");if(r===t)return decodeURIComponent(s??"")}return null}(t,l);if(!r)return null;let s=await e.DB.prepare("SELECT user_id, expires_at FROM sessions WHERE id = ?").bind(r).all(),a=s.results?.[0];if(!a)return null;let i=Math.floor(Date.now()/1e3),n=Number(a.expires_at);return Number.isFinite(n)&&n<i?null:a.user_id}},2491:(e,t,r)=>{"use strict";r.d(t,{O:()=>a});var s=r(9650);function a(){return(0,s.getRequestContext)().env}}},e=>{var t=t=>e(e.s=t);e.O(0,[992,111,109],()=>t(1685));var r=e.O();(_ENTRIES="undefined"==typeof _ENTRIES?{}:_ENTRIES)["middleware_app/api/auth/[...lucia]/route"]=r}]);
//# sourceMappingURL=route.js.map