"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[875],{129:(e,t,s)=>{let i;s.d(t,{Z:()=>a});let r={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},n=new Uint8Array(16),o=[];for(let e=0;e<256;++e)o.push((e+256).toString(16).slice(1));let a=function(e,t,s){if(r.randomUUID&&!t&&!e)return r.randomUUID();let a=(e=e||{}).random||(e.rng||function(){if(!i&&!(i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(n)})();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){s=s||0;for(let e=0;e<16;++e)t[s+e]=a[e];return t}return function(e,t=0){return o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]}(a)}},3611:(e,t,s)=>{s.d(t,{rs:()=>o});class i{controller;escapedUserTableName;escapedSessionTableName;constructor(e,t){this.controller=e,this.escapedSessionTableName=n(t.session),this.escapedUserTableName=n(t.user)}async deleteSession(e){await this.controller.execute(`DELETE FROM ${this.escapedSessionTableName} WHERE id = ?`,[e])}async deleteUserSessions(e){await this.controller.execute(`DELETE FROM ${this.escapedSessionTableName} WHERE user_id = ?`,[e])}async getSessionAndUser(e){let[t,s]=await Promise.all([this.getSession(e),this.getUserFromSessionId(e)]);return[t,s]}async getUserSessions(e){return(await this.controller.getAll(`SELECT * FROM ${this.escapedSessionTableName} WHERE user_id = ?`,[e])).map(e=>r(e))}async setSession(e){let t=Object.entries({id:e.id,user_id:e.userId,expires_at:Math.floor(e.expiresAt.getTime()/1e3),...e.attributes}).filter(([e,t])=>void 0!==t),s=t.map(([e])=>n(e)),i=Array(s.length).fill("?"),r=t.map(([e,t])=>t);await this.controller.execute(`INSERT INTO ${this.escapedSessionTableName} (${s.join(", ")}) VALUES (${i.join(", ")})`,r)}async updateSessionExpiration(e,t){await this.controller.execute(`UPDATE ${this.escapedSessionTableName} SET expires_at = ? WHERE id = ?`,[Math.floor(t.getTime()/1e3),e])}async deleteExpiredSessions(){await this.controller.execute(`DELETE FROM ${this.escapedSessionTableName} WHERE expires_at <= ?`,[Math.floor(Date.now()/1e3)])}async getSession(e){let t=await this.controller.get(`SELECT * FROM ${this.escapedSessionTableName} WHERE id = ?`,[e]);return t?r(t):null}async getUserFromSessionId(e){let t=await this.controller.get(`SELECT ${this.escapedUserTableName}.* FROM ${this.escapedSessionTableName} INNER JOIN ${this.escapedUserTableName} ON ${this.escapedUserTableName}.id = ${this.escapedSessionTableName}.user_id WHERE ${this.escapedSessionTableName}.id = ?`,[e]);return t?function(e){let{id:t,...s}=e;return{id:t,attributes:s}}(t):null}}function r(e){let{id:t,user_id:s,expires_at:i,...r}=e;return{userId:s,id:t,expiresAt:new Date(1e3*i),attributes:r}}function n(e){return"`"+e+"`"}class o extends i{constructor(e,t){super(new a(e),t)}}class a{db;constructor(e){this.db=e}async get(e,t){return await this.db.prepare(e).bind(...t).first()}async getAll(e,t){return(await this.db.prepare(e).bind(...t).all()).results??[]}async execute(e,t){await this.db.prepare(e).bind(...t).run()}}},7766:(e,t,s)=>{var i,r,n,o;s.d(t,{aF:()=>f,i9:()=>a});class a{constructor(e,t){this.value=e,this.unit=t}value;unit;milliseconds(){return"ms"===this.unit?this.value:"s"===this.unit?1e3*this.value:"m"===this.unit?6e4*this.value:"h"===this.unit?36e5*this.value:"d"===this.unit?864e5*this.value:6048e5*this.value}seconds(){return this.milliseconds()/1e3}transform(e){return new a(Math.round(this.milliseconds()*e),"ms")}}function u(e){return Date.now()<e.getTime()}function l(e){return new Date(Date.now()+e.milliseconds())}class h{constructor(e,t,s){this.cookieName=e,this.cookieExpiresIn=s?.expiresIn??null,this.baseCookieAttributes=t}cookieName;cookieExpiresIn;baseCookieAttributes;createCookie(e){return new p(this.cookieName,e,{...this.baseCookieAttributes,maxAge:this.cookieExpiresIn?.seconds()})}createBlankCookie(){return new p(this.cookieName,"",{...this.baseCookieAttributes,maxAge:0})}parse(e){return(function(e){let t=new Map;for(let s of e.split("; ")){let e=s.split("="),i=e[0],r=e[1]??"";i&&t.set(decodeURIComponent(i),decodeURIComponent(r))}return t})(e).get(this.cookieName)??null}}class p{constructor(e,t,s){this.name=e,this.value=t,this.attributes=s}name;value;attributes;serialize(){return function(e,t,s){let i=[];return i.push([encodeURIComponent(e),encodeURIComponent(t)]),s?.domain!==void 0&&i.push(["Domain",s.domain]),s?.expires!==void 0&&i.push(["Expires",s.expires.toUTCString()]),s?.httpOnly&&i.push(["HttpOnly"]),s?.maxAge!==void 0&&i.push(["Max-Age",s.maxAge.toString()]),s?.path!==void 0&&i.push(["Path",s.path]),s?.sameSite==="lax"&&i.push(["SameSite","Lax"]),s?.sameSite==="none"&&i.push(["SameSite","None"]),s?.sameSite==="strict"&&i.push(["SameSite","Strict"]),s?.secure&&i.push(["Secure"]),i.map(e=>e.join("=")).join("; ")}(this.name,this.value,this.attributes)}}!function(e){e[e.Include=0]="Include",e[e.None=1]="None"}(i||(i={})),function(e){e[e.Required=0]="Required",e[e.Ignore=1]="Ignore"}(r||(r={})),!function(e){e[e.Include=0]="Include",e[e.None=1]="None"}(n||(n={})),function(e){e[e.Required=0]="Required",e[e.Ignore=1]="Ignore"}(o||(o={}));class c{uint8(e,t){if(e.byteLength<t+1)throw TypeError("Insufficient bytes");return e[t]}uint16(e,t){if(e.byteLength<t+2)throw TypeError("Insufficient bytes");return e[t]<<8|e[t+1]}uint32(e,t){if(e.byteLength<t+4)throw TypeError("Insufficient bytes");let s=0;for(let i=0;i<4;i++)s|=e[t+i]<<24-8*i;return s}uint64(e,t){if(e.byteLength<t+8)throw TypeError("Insufficient bytes");let s=0n;for(let i=0;i<8;i++)s|=BigInt(e[t+i])<<BigInt(56-8*i);return s}putUint8(e,t,s){if(e.length<s+1)throw TypeError("Not enough space");if(t<0||t>255)throw TypeError("Invalid uint8 value");e[s]=t}putUint16(e,t,s){if(e.length<s+2)throw TypeError("Not enough space");if(t<0||t>65535)throw TypeError("Invalid uint16 value");e[s]=t>>8,e[s+1]=255&t}putUint32(e,t,s){if(e.length<s+4)throw TypeError("Not enough space");if(t<0||t>4294967295)throw TypeError("Invalid uint32 value");for(let i=0;i<4;i++)e[s+i]=t>>(3-i)*8&255}putUint64(e,t,s){if(e.length<s+8)throw TypeError("Not enough space");if(t<0||t>0xffffffffffffffffn)throw TypeError("Invalid uint64 value");for(let i=0;i<8;i++)e[s+i]=Number(t>>BigInt((7-i)*8)&255n)}}class d{uint8(e,t){if(e.byteLength<t+1)throw TypeError("Insufficient bytes");return e[t]}uint16(e,t){if(e.byteLength<t+2)throw TypeError("Insufficient bytes");return e[t]|e[t+1]<<8}uint32(e,t){if(e.byteLength<t+4)throw TypeError("Insufficient bytes");let s=0;for(let i=0;i<4;i++)s|=e[t+i]<<8*i;return s}uint64(e,t){if(e.byteLength<t+8)throw TypeError("Insufficient bytes");let s=0n;for(let i=0;i<8;i++)s|=BigInt(e[t+i])<<BigInt(8*i);return s}putUint8(e,t,s){if(e.length<1+s)throw TypeError("Insufficient space");if(t<0||t>255)throw TypeError("Invalid uint8 value");e[s]=t}putUint16(e,t,s){if(e.length<2+s)throw TypeError("Insufficient space");if(t<0||t>65535)throw TypeError("Invalid uint16 value");e[s+1]=t>>8,e[s]=255&t}putUint32(e,t,s){if(e.length<4+s)throw TypeError("Insufficient space");if(t<0||t>4294967295)throw TypeError("Invalid uint32 value");for(let i=0;i<4;i++)e[s+i]=t>>8*i&255}putUint64(e,t,s){if(e.length<8+s)throw TypeError("Insufficient space");if(t<0||t>0xffffffffffffffffn)throw TypeError("Invalid uint64 value");for(let i=0;i<8;i++)e[s+i]=Number(t>>BigInt(8*i)&255n)}}new c,new d;class f{adapter;sessionExpiresIn;sessionCookieController;getSessionAttributes;getUserAttributes;sessionCookieName;constructor(e,t){this.adapter=e,this.getUserAttributes=e=>t&&t.getUserAttributes?t.getUserAttributes(e):{},this.getSessionAttributes=e=>t&&t.getSessionAttributes?t.getSessionAttributes(e):{},this.sessionExpiresIn=t?.sessionExpiresIn??new a(30,"d"),this.sessionCookieName=t?.sessionCookie?.name??"auth_session";let s=this.sessionExpiresIn;t?.sessionCookie?.expires===!1&&(s=new a(400,"d"));let i={httpOnly:!0,secure:!0,sameSite:"lax",path:"/",...t?.sessionCookie?.attributes};this.sessionCookieController=new h(this.sessionCookieName,i,{expiresIn:s})}async getUserSessions(e){let t=await this.adapter.getUserSessions(e),s=[];for(let e of t)u(e.expiresAt)&&s.push({id:e.id,expiresAt:e.expiresAt,userId:e.userId,fresh:!1,...this.getSessionAttributes(e.attributes)});return s}async validateSession(e){let[t,s]=await this.adapter.getSessionAndUser(e);if(!t)return{session:null,user:null};if(!s||!u(t.expiresAt))return await this.adapter.deleteSession(t.id),{session:null,user:null};let i=new Date(t.expiresAt.getTime()-this.sessionExpiresIn.milliseconds()/2),r={...this.getSessionAttributes(t.attributes),id:t.id,userId:t.userId,fresh:!1,expiresAt:t.expiresAt};return u(i)||(r.fresh=!0,r.expiresAt=l(this.sessionExpiresIn),await this.adapter.updateSessionExpiration(t.id,r.expiresAt)),{user:{...this.getUserAttributes(s.attributes),id:s.id},session:r}}async createSession(e,t,s){let r=s?.sessionId??function(e,t,s){let r="";for(let n=0;n<e.byteLength;n+=5){let o=0n,a=0;for(let t=0;t<5&&n+t<e.byteLength;t++)o=o<<8n|BigInt(e[n+t]),a+=8;a%5!=0&&(o<<=BigInt(5-a%5),a+=5-a%5);for(let e=0;e<8;e++)a>=5?(r+=t[Number(o>>BigInt(a-5)&31n)],a-=5):a>0?(r+=t[Number(o<<BigInt(6-a)&63n)],a=0):s===i.Include&&(r+="=")}return r}(crypto.getRandomValues(new Uint8Array(25)),"abcdefghijklmnopqrstuvwxyz234567",i.None),n=l(this.sessionExpiresIn);return await this.adapter.setSession({id:r,userId:e,expiresAt:n,attributes:t}),{id:r,userId:e,fresh:!0,expiresAt:n,...this.getSessionAttributes(t)}}async invalidateSession(e){await this.adapter.deleteSession(e)}async invalidateUserSessions(e){await this.adapter.deleteUserSessions(e)}async deleteExpiredSessions(){await this.adapter.deleteExpiredSessions()}readSessionCookie(e){return this.sessionCookieController.parse(e)}readBearerToken(e){let[t,s]=e.split(" ");return"Bearer"!==t?null:s??null}createSessionCookie(e){return this.sessionCookieController.createCookie(e)}createBlankSessionCookie(){return this.sessionCookieController.createBlankCookie()}}}}]);
//# sourceMappingURL=875.js.map